<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battle4Life</title>
    <link rel="stylesheet" href="styles.css">
    <script src="script.js"></script>
</head>
<body>
    <div class="game-container">
        <!-- Game Mode Selection - Now First Screen -->
        <div id="gameModeScreen" class="screen game-mode-select active">
            <h1 class="title">Battle4Life</h1>
            <h2 style="margin-bottom: 30px;">Choose Game Mode</h2>
            <div class="map-selection">
                <div class="map-card" onclick="selectGameMode('singleplayer')">
                    <h3><span class="emoji">ğŸ¤–</span> Single Player</h3>
                    <p>Battle against AI opponents</p>
                    <small>Share characters and coins</small>
                </div>
                <div class="map-card" onclick="selectGameMode('multiplayer')">
                    <h3><span class="emoji">ğŸ‘¥</span> Two Players</h3>
                    <p>Battle against a friend locally</p>
                    <small>Separate inventories, winner takes all!</small>
                </div>
            </div>
        </div>

        <!-- Coins Display (Single Player) -->
        <div id="singlePlayerCoins" class="coins-display" style="display: none;">
            <span class="emoji">ğŸ’°</span> <span id="coinCount">100</span> Coins
        </div>

        <!-- Player Coins Display (Multiplayer) -->
        <div id="player1Coins" class="player-coins player1-coins" style="display: none;">
            <span class="emoji">ğŸ’°</span> P1: <span id="player1CoinCount">75</span>
        </div>
        <div id="player2Coins" class="player-coins player2-coins" style="display: none;">
            <span class="emoji">ğŸ’°</span> P2: <span id="player2CoinCount">75</span>
        </div>

        <!-- Universal Coin Display for All Screens -->
        <div id="universalCoins" class="universal-coins" style="display: none;">
            <!-- Single Player Mode -->
            <div id="singlePlayerCoinDisplay" style="display: none;">
                <span class="emoji">ğŸ’°</span> <span id="universalCoinCount">100</span> Coins
            </div>
            <!-- Multiplayer Mode -->
            <div id="multiplayerCoinDisplay" style="display: none;">
                <div class="player-coin-row">
                    <span class="player1-coin">ğŸŸ¢ P1: <span id="universalPlayer1Coins">75</span></span>
                </div>
                <div class="player-coin-row">
                    <span class="player2-coin">ğŸŸ  P2: <span id="universalPlayer2Coins">75</span></span>
                </div>
            </div>
        </div>

        <!-- Main Menu -->
        <div id="mainMenu" class="screen main-menu" style="display: grid; grid-template-columns: 1fr 2fr 1fr; grid-template-rows: 1fr 2fr 1fr; height: 100vh; padding: 20px; gap: 20px;">
            <!-- Top Left: Shop (Single Player) / Empty (Multiplayer) -->
            <button class="button" id="topLeftBtn" onclick="showShop()" style="grid-column: 1; grid-row: 1; font-size: 24px; padding: 20px; height: auto; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <span class="emoji" style="font-size: 48px; margin-bottom: 10px;">ğŸ›’</span>
                <span>Shop</span>
            </button>
            
            <!-- Top Center: Trophy Road (Single Player) / Shop (Multiplayer) -->
            <button class="button" id="topCenterBtn" onclick="showTrophyRoad()" style="grid-column: 2; grid-row: 1; font-size: 24px; padding: 20px; height: auto; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <span class="emoji" style="font-size: 48px; margin-bottom: 10px;">ğŸ†</span>
                <span>Trophy Road</span>
            </button>
            
            <!-- Top Right: Challenges (Single Player) / Empty (Multiplayer) -->
            <button class="button" id="topRightBtn" onclick="showChallenges()" style="grid-column: 3; grid-row: 1; font-size: 24px; padding: 20px; height: auto; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <span class="emoji" style="font-size: 48px; margin-bottom: 10px;">ğŸ¯</span>
                <span>Challenges</span>
            </button>
            
            <!-- Center: Epic Battle Arena Title -->
            <div style="grid-column: 2; grid-row: 2; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;">
                <h1 class="title" style="font-size: 4em; margin: 0; text-shadow: 4px 4px 8px rgba(0,0,0,0.8);">Battle4Life</h1>
                <button class="button" onclick="showGameModeSelect()" style="margin-top: 20px; font-size: 18px; padding: 15px 30px;">
                    <span class="emoji">ğŸ”„</span> Change Mode
                </button>
                <button class="button" onclick="confirmResetAccount()" style="margin-top: 10px; font-size: 16px; padding: 12px 25px; background: linear-gradient(135deg, #ff4444, #cc0000); border-color: #ff0000;">
                    <span class="emoji">ğŸ”¥</span> Reset Account
                </button>
            </div>
            
            <!-- Bottom Left: Badges -->
            <button class="button" onclick="showBadges()" style="grid-column: 1; grid-row: 3; font-size: 24px; padding: 20px; height: auto; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <span class="emoji" style="font-size: 48px; margin-bottom: 10px;">ğŸ…</span>
                <span>Badges</span>
            </button>
            
            <!-- Bottom Center: Collection -->
            <button class="button" onclick="showCollection()" style="grid-column: 2; grid-row: 3; font-size: 24px; padding: 20px; height: auto; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <span class="emoji" style="font-size: 48px; margin-bottom: 10px;">ğŸ“š</span>
                <span>Collection</span>
            </button>
            
            <!-- Bottom Right: Battle -->
            <button class="button" onclick="showBattleModeSelect()" style="grid-column: 3; grid-row: 3; font-size: 24px; padding: 20px; height: auto; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(45deg, #FF4444, #FF6B6B); border-color: #FF4444;">
                <span class="emoji" style="font-size: 48px; margin-bottom: 10px;">âš”ï¸</span>
                <span>Battle</span>
            </button>
        </div>

        <!-- Shop Screen -->
        <div id="shopScreen" class="screen shop-screen" style="overflow-y: auto; padding: 20px;">
            <h2 class="title">Mystery Chest Shop</h2>
            <div style="text-align: center; color: #FFD700; font-size: 16px; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                âœ¨ Each chest contains Characters OR Badges! âœ¨
            </div>
            <div id="shopPlayerInfo" class="player-selection-info"></div>
            <div class="chest-container" style="max-height: 70vh; overflow-y: auto;">
                <div class="chest common-chest" onclick="buyChest('common')" style="background: linear-gradient(45deg, #9e9e9e, #bdbdbd); border-color: #9e9e9e;">
                    <span class="emoji">ğŸ</span><br>Common Chest<br>100 Coins<br><small>70%C, 25%R, 4%E, 1%L</small><br><small style="color: #FFD700;">ğŸ­ or ğŸ…</small>
                </div>
                <div class="chest rare-chest" onclick="buyChest('rare')" style="background: linear-gradient(45deg, #2196f3, #64b5f6); border-color: #2196f3;">
                    <span class="emoji">ğŸ’</span><br>Rare Chest<br>200 Coins<br><small>45%C, 35%R, 17%E, 3%L</small><br><small style="color: #FFD700;">ğŸ­ or ğŸ…</small>
                </div>
                <div class="chest epic-chest" onclick="buyChest('epic')" style="background: linear-gradient(45deg, #9c27b0, #ba68c8); border-color: #9c27b0;">
                    <span class="emoji">âš¡</span><br>Epic Chest<br>350 Coins<br><small>35%C, 35%R, 20%E, 10%L</small><br><small style="color: #FFD700;">ğŸ­ or ğŸ…</small>
                </div>
                <div class="chest legendary-chest" onclick="buyChest('legendary')" style="background: linear-gradient(45deg, #ff9800, #ffb74d); border-color: #ff9800;">
                    <span class="emoji">ğŸŒŸ</span><br>Legendary Chest<br>600 Coins<br><small>30%C, 25%R, 20%E, 25%L</small><br><small style="color: #FFD700;">ğŸ­ or ğŸ…</small>
                </div>
                <div class="chest mega-chest" onclick="buyChest('mega')" style="background: linear-gradient(45deg, #FFD700, #FFA500); border-color: #FFD700; position: relative; overflow: hidden; width: 170px; height: 140px;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #FFD700, #FF6B35, #FFD700); animation: megaGlow 2s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold; text-align: center; padding: 5px;">
                        <span class="emoji" style="font-size: 24px;">ğŸ°</span><br>
                        <strong style="font-size: 14px;">MEGA CHEST</strong><br>
                        <strong style="font-size: 14px;">750 Coins</strong><br>
                        <small style="color: #FF0000; font-weight: bold; font-size: 11px; text-shadow: 1px 1px 2px rgba(255,255,255,0.9);">3 ITEMS!</small><br>
                        <small style="font-size: 10px;">ğŸ­ or ğŸ… (Random Mix!)</small>
                    </div>
                </div>
                <div class="chest legendary-guaranteed-chest" onclick="buyChest('guaranteed')" style="background: linear-gradient(45deg, #FF9800, #FFD700, #FF9800); border-color: #FF9800; position: relative; overflow: hidden; width: 170px; height: 140px; box-shadow: 0 0 20px #FF9800;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #FF9800, #FFD700, #FF4500, #FFD700, #FF9800); animation: legendaryPulse 1.5s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold; text-align: center; padding: 5px;">
                        <span class="emoji" style="font-size: 24px;">ğŸ‘‘</span><br>
                        <strong style="font-size: 12px; color: #00FF00; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">GUARANTEED</strong><br>
                        <strong style="font-size: 12px; color: #00FF00; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">LEGENDARY</strong><br>
                        <strong style="font-size: 14px; color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">1200 Coins</strong><br>
                        <small style="color: #FFD700; font-weight: bold; font-size: 11px; text-shadow: 1px 1px 2px rgba(0,0,0,0.9);">ğŸ­ or ğŸ…</small>
                    </div>
                </div>
                <div class="chest choose-character-chest" onclick="buyChest('choose')" style="background: linear-gradient(45deg, #9C27B0, #E91E63, #9C27B0); border-color: #9C27B0; position: relative; overflow: hidden; width: 170px; height: 140px; box-shadow: 0 0 25px #9C27B0;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #9C27B0, #E91E63, #FF6B35, #E91E63, #9C27B0); animation: choosePulse 1.2s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); font-weight: bold; text-align: center; padding: 5px;">
                        <span class="emoji" style="font-size: 24px;">ğŸ¯</span><br>
                        <strong style="font-size: 12px; color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">CHOOSE YOUR</strong><br>
                        <strong style="font-size: 12px; color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">ITEM</strong><br>
                        <strong style="font-size: 14px; color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">1500 Coins</strong><br>
                        <small style="color: #FFD700; font-weight: bold; font-size: 11px; text-shadow: 1px 1px 2px rgba(0,0,0,0.9);">PICK ANY ğŸ­ or ğŸ…!</small>
                    </div>
                </div>
            </div>
            <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #FFD700;">
                <h3 style="color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); margin-bottom: 15px;">ADDON SHOP</h3>
                <div style="text-align: center; color: #FFD700; font-size: 14px; margin-bottom: 15px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">
                    Cosmetic items: Hats, Shirts, Pants, Shoes!
                </div>
                <div class="chest-container">
                    <div class="chest addon-chest" onclick="buyAddonChest('common')" style="background: linear-gradient(45deg, #9e9e9e, #bdbdbd); border-color: #9e9e9e;">
                        <span class="emoji">ğŸ‘•</span><br>Common Addon<br>150 Coins<br><small>70%C, 25%R, 4%E, 1%L</small>
                    </div>
                    <div class="chest addon-chest" onclick="buyAddonChest('rare')" style="background: linear-gradient(45deg, #2196f3, #64b5f6); border-color: #2196f3;">
                        <span class="emoji">ğŸ‘”</span><br>Rare Addon<br>300 Coins<br><small>45%C, 35%R, 17%E, 3%L</small>
                    </div>
                    <div class="chest addon-chest" onclick="buyAddonChest('epic')" style="background: linear-gradient(45deg, #9c27b0, #ba68c8); border-color: #9c27b0;">
                        <span class="emoji">ğŸ½</span><br>Epic Addon<br>500 Coins<br><small>35%C, 35%R, 20%E, 10%L</small>
                    </div>
                    <div class="chest addon-chest" onclick="buyAddonChest('legendary')" style="background: linear-gradient(45deg, #ff9800, #ffb74d); border-color: #ff9800;">
                        <span class="emoji">ğŸ‘‘</span><br>Legendary Addon<br>800 Coins<br><small>30%C, 25%R, 20%E, 25%L</small>
                    </div>
                </div>
            </div>
            <button class="button" onclick="returnToMainMenuWithLoading('shop')" style="position: sticky; bottom: 10px; z-index: 100;">â† Back</button>
        </div>

        <!-- Character Collection -->
        <div id="collectionScreen" class="screen" style="overflow-y: auto; padding: 20px;">
            <h2 class="title">Character Collection</h2>
            <div id="collectionPlayerInfo" class="player-selection-info"></div>
            <div id="characterGrid" class="character-grid" style="max-height: 70vh;"></div>
            <button class="button" onclick="returnToMainMenuWithLoading('collection')" style="position: sticky; bottom: 10px; z-index: 100;">â† Back</button>
        </div>

        <!-- Character Detail Screen -->
        <div id="characterDetailScreen" class="screen" style="overflow: hidden; padding: 0; width: 100vw; height: 100vh;">
            <div style="display: flex; width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);">
                <!-- Left Side: Favorite Button, In-Game Stats & Exit -->
                <div style="width: 25%; display: flex; flex-direction: column; padding: 40px 30px; background: rgba(0,0,0,0.4);">
                    <button id="favoriteBtn" class="button" onclick="toggleFavorite()" style="font-size: 24px; padding: 25px; background: linear-gradient(45deg, #FFD700, #FFA500); border: 4px solid #FFD700; box-shadow: 0 0 30px rgba(255,215,0,0.5); flex-shrink: 0;">
                        â­ Favorite
                    </button>

                    <!-- In-Game Stats (Scrollable) -->
                    <div style="flex: 1; display: flex; flex-direction: column; padding: 30px 0; overflow: hidden;">
                        <h3 style="color: #4CAF50; font-size: 22px; margin-bottom: 20px; text-align: center; text-shadow: 0 0 15px rgba(76,175,80,0.8); flex-shrink: 0;">ğŸ® IN-GAME STATS</h3>
                        <div id="characterInGameStats" style="font-size: 15px; line-height: 1.8; overflow-y: auto; overflow-x: hidden; padding-right: 10px;">
                            <!-- In-game stats will be inserted here -->
                        </div>
                    </div>

                    <button class="button" onclick="closeCharacterDetail()" style="font-size: 22px; padding: 25px; background: linear-gradient(45deg, #FF4444, #CC0000); border: 4px solid #FF4444; box-shadow: 0 0 30px rgba(255,68,68,0.5); flex-shrink: 0;">
                        âœ– Exit
                    </button>
                </div>

                <!-- Center: Dancing Character (SCROLLABLE) -->
                <div style="width: 50%; display: flex; flex-direction: column; align-items: center; position: relative; overflow-y: auto; overflow-x: hidden; padding: 20px 10px;">
                    <!-- Animated Character Canvas -->
                    <canvas id="characterDetailCanvas" width="600" height="800" style="filter: drop-shadow(0 0 50px rgba(255,215,0,0.6)); flex-shrink: 0;"></canvas>

                    <div id="characterDetailName" style="font-size: 48px; font-weight: bold; color: #FFD700; margin-top: 30px; text-shadow: 0 0 30px rgba(255,215,0,1), 0 0 60px rgba(255,215,0,0.5); flex-shrink: 0;">
                        Spider Hero
                    </div>
                    <div id="characterDetailRarity" style="font-size: 32px; color: #4CAF50; margin-top: 15px; text-transform: uppercase; font-weight: bold; text-shadow: 0 0 20px currentColor; flex-shrink: 0;">
                        COMMON
                    </div>

                    <!-- Addon Equipping UI -->
                    <div style="margin-top: 40px; margin-bottom: 40px; padding: 20px; background: rgba(0,0,0,0.6); border-radius: 15px; border: 2px solid #FFD700; width: 90%; max-width: 500px; flex-shrink: 0;">
                        <h3 style="color: #FFD700; font-size: 20px; margin-bottom: 15px; text-align: center; text-shadow: 0 0 10px rgba(255,215,0,0.8);">EQUIP ADDONS</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <!-- Hat Slot -->
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="color: #FFD700; font-size: 14px; margin-bottom: 5px;">HAT</div>
                                <select id="addonHatSelect" onchange="equipAddon('hat', this.value)" style="width: 100%; padding: 8px; background: #1a1a2e; color: #FFD700; border: 2px solid #FFD700; border-radius: 5px; font-size: 12px;">
                                    <option value="">None</option>
                                </select>
                            </div>
                            <!-- Shirt Slot -->
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="color: #FFD700; font-size: 14px; margin-bottom: 5px;">SHIRT</div>
                                <select id="addonShirtSelect" onchange="equipAddon('shirt', this.value)" style="width: 100%; padding: 8px; background: #1a1a2e; color: #FFD700; border: 2px solid #FFD700; border-radius: 5px; font-size: 12px;">
                                    <option value="">None</option>
                                </select>
                            </div>
                            <!-- Pants Slot -->
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="color: #FFD700; font-size: 14px; margin-bottom: 5px;">PANTS</div>
                                <select id="addonPantsSelect" onchange="equipAddon('pants', this.value)" style="width: 100%; padding: 8px; background: #1a1a2e; color: #FFD700; border: 2px solid #FFD700; border-radius: 5px; font-size: 12px;">
                                    <option value="">None</option>
                                </select>
                            </div>
                            <!-- Shoes Slot -->
                            <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="color: #FFD700; font-size: 14px; margin-bottom: 5px;">SHOES</div>
                                <select id="addonShoesSelect" onchange="equipAddon('shoes', this.value)" style="width: 100%; padding: 8px; background: #1a1a2e; color: #FFD700; border: 2px solid #FFD700; border-radius: 5px; font-size: 12px;">
                                    <option value="">None</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Side: Stats (Scrollable) -->
                <div style="width: 25%; display: flex; flex-direction: column; padding: 40px 30px; background: rgba(0,0,0,0.4);">
                    <h3 style="color: #FFD700; font-size: 28px; margin-bottom: 30px; text-align: center; text-shadow: 0 0 20px rgba(255,215,0,0.8); flex-shrink: 0;">ğŸ“Š CHARACTER STATS</h3>
                    <div id="characterDetailStats" style="font-size: 16px; line-height: 1.8; overflow-y: auto; overflow-x: hidden; padding-right: 10px; flex: 1;">
                        <!-- Stats will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Character Selection -->
        <div id="characterSelectScreen" class="screen">
            <h2 class="title" id="characterSelectTitle">Select Your Fighter</h2>
            <div id="characterSelectPlayerInfo" class="player-selection-info"></div>
            <div id="selectableCharacters" class="character-grid"></div>
            <button class="button" id="characterNextBtn" onclick="handleCharacterNext()">Next â†’</button>
            <button class="button" onclick="showMainMenu()">â† Back</button>
        </div>

        <!-- Player 2 Character Selection -->
        <div id="player2SelectScreen" class="screen">
            <h2 class="title">Player 2: Select Your Fighter</h2>
            <div class="player-selection-info">Player 2's Characters</div>
            <div id="player2Characters" class="character-grid"></div>
            <button class="button" onclick="showMapSelectMultiplayer()">Next â†’</button>
            <button class="button" onclick="showCharacterSelect()">â† Back</button>
        </div>

        <!-- Difficulty Selection -->
        <div id="difficultySelectScreen" class="screen">
            <h2 class="title">Select Difficulty</h2>
            <div class="map-selection">
                <div class="map-card" onclick="selectDifficulty('beginner')">
                    <h3><span class="emoji">ğŸ˜Š</span> Beginner</h3>
                    <p>Easy AI, Common enemies</p>
                </div>
                <div class="map-card" onclick="selectDifficulty('intermediate')">
                    <h3><span class="emoji">ğŸ˜</span> Intermediate</h3>
                    <p>Smart AI, Rare enemies</p>
                </div>
                <div class="map-card" onclick="selectDifficulty('hard')">
                    <h3><span class="emoji">ğŸ˜°</span> Hard</h3>
                    <p>Tough AI, Epic enemies</p>
                </div>
                <div class="map-card" onclick="selectDifficulty('impossible')">
                    <h3><span class="emoji">ğŸ’€</span> Almost Impossible</h3>
                    <p>Expert AI, Legendary enemies</p>
                </div>
            </div>
            <button class="button" onclick="showCharacterSelect()">â† Back</button>
        </div>

        <!-- Map Selection -->
        <div id="mapSelectScreen" class="screen">
            <h2 class="title">Choose Battlefield</h2>
            <div class="map-selection" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); max-width: 1000px;">
                <div class="map-card" onclick="selectMap('city')">
                    <h4><span class="emoji">ğŸ™ï¸</span> City Rooftop</h4>
                    <small>Multiple platforms, urban danger</small>
                </div>
                <div class="map-card" onclick="selectMap('forest')">
                    <h4><span class="emoji">ğŸŒ²</span> Mystic Forest</h4>
                    <small>Tree platforms, nature magic</small>
                </div>
                <div class="map-card" onclick="selectMap('arena')">
                    <h4><span class="emoji">ğŸŸï¸</span> Gladiator Arena</h4>
                    <small>Classic combat, minimal cover</small>
                </div>
                <div class="map-card" onclick="selectMap('space')">
                    <h4><span class="emoji">ğŸš€</span> Space Station</h4>
                    <small>Zero gravity zones, tech hazards</small>
                </div>
                <div class="map-card" onclick="selectMap('underwater')">
                    <h4><span class="emoji">ğŸŒŠ</span> Ocean Depths</h4>
                    <small>Coral barriers, water currents</small>
                </div>
                <div class="map-card" onclick="selectMap('volcano')">
                    <h4><span class="emoji">ğŸŒ‹</span> Lava Cavern</h4>
                    <small>ACTIVE VOLCANO! Lava geysers</small>
                </div>
                <div class="map-card" onclick="selectMap('ice')">
                    <h4><span class="emoji">â„ï¸</span> Frozen Wasteland</h4>
                    <small>Slippery ice, freezing winds</small>
                </div>
                <div class="map-card" onclick="selectMap('desert')">
                    <h4><span class="emoji">ğŸœï¸</span> Sand Dunes</h4>
                    <small>Sandstorms, shifting terrain</small>
                </div>
                <div class="map-card" onclick="selectMap('jungle')">
                    <h4><span class="emoji">ğŸŒ¿</span> Amazon Temple</h4>
                    <small>Vine swings, ancient traps</small>
                </div>
                <div class="map-card" onclick="selectMap('castle')">
                    <h4><span class="emoji">ğŸ°</span> Medieval Keep</h4>
                    <small>Stone towers, archer slots</small>
                </div>
                <div class="map-card" onclick="selectMap('laboratory')">
                    <h4><span class="emoji">ğŸ§ª</span> Cyber Lab</h4>
                    <small>Electric barriers, tech pods</small>
                </div>
                <div class="map-card" onclick="selectMap('heaven')">
                    <h4><span class="emoji">â˜ï¸</span> Cloud Kingdom</h4>
                    <small>Heavenly pillars, divine light</small>
                </div>
                <div class="map-card" onclick="selectMap('hell')">
                    <h4><span class="emoji">ğŸ”¥</span> Inferno Realm</h4>
                    <small>Fire pits, demon portals</small>
                </div>
                <div class="map-card" onclick="selectMap('moon')">
                    <h4><span class="emoji">ğŸŒ™</span> Lunar Surface</h4>
                    <small>Low gravity, meteor craters</small>
                </div>
                <div class="map-card" onclick="selectMap('matrix')">
                    <h4><span class="emoji">ğŸ’»</span> Digital World</h4>
                    <small>Code platforms, data streams</small>
                </div>
            </div>
            <button class="button" onclick="showDifficultySelect()">â† Back</button>
        </div>

        <!-- Battle Preparation Screen -->
        <div id="battlePrepScreen" class="screen" style="background: linear-gradient(45deg, #1a1a2e, #16213e); padding: 20px;">
            <h2 class="title" style="color: #FFD700; margin-bottom: 40px;">âš”ï¸ BATTLE PREPARATION âš”ï¸</h2>
            
            <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto;">
                <!-- Player 1 Character -->
                <div id="player1PrepCard" class="prep-character-card">
                    <div class="prep-character-avatar" id="player1PrepAvatar">
                        <span class="emoji" id="player1PrepEmoji">ğŸ•·ï¸</span>
                    </div>
                    <div class="prep-character-name" id="player1PrepName">Spider Hero</div>
                    <div class="prep-character-rarity" id="player1PrepRarity">COMMON</div>
                    
                    <div class="prep-stats">
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">ğŸ’š HP:</span>
                            <span class="prep-stat-value" id="player1PrepHP">210</span>
                        </div>
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">âš”ï¸ Normal:</span>
                            <span class="prep-stat-value" id="player1PrepNormal">25</span>
                        </div>
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">ğŸ’¥ Special:</span>
                            <span class="prep-stat-value" id="player1PrepSpecial">45</span>
                        </div>
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">ğŸ”„ Normal Reload:</span>
                            <span class="prep-stat-value" id="player1PrepNormalReload">0.8s</span>
                        </div>
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">âš¡ Special Reload:</span>
                            <span class="prep-stat-value" id="player1PrepSpecialReload">14.0s</span>
                        </div>
                    </div>
                </div>

                <!-- VS and Ready Button -->
                <div style="text-align: center;">
                    <div style="font-size: 4em; color: #FF4444; font-weight: bold; margin-bottom: 30px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">VS</div>
                    <button class="button" id="readyToAttackBtn" onclick="startBattleFromPrep()" style="font-size: 24px; padding: 20px 40px; background: linear-gradient(45deg, #FF4444, #FF6B6B); animation: pulseReady 2s ease-in-out infinite;">
                        ğŸ”¥ READY TO ATTACK!!!!!!!!! ğŸ”¥
                    </button>
                    <div style="margin-top: 20px; color: #FFD700; font-size: 18px; font-weight: bold;" id="battleMapInfo">Map: City Rooftop</div>
                </div>

                <!-- Player 2 Character -->
                <div id="player2PrepCard" class="prep-character-card">
                    <div class="prep-character-avatar" id="player2PrepAvatar">
                        <span class="emoji" id="player2PrepEmoji">ğŸ”¥</span>
                    </div>
                    <div class="prep-character-name" id="player2PrepName">Flame Master</div>
                    <div class="prep-character-rarity" id="player2PrepRarity">COMMON</div>
                    
                    <div class="prep-stats">
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">ğŸ’š HP:</span>
                            <span class="prep-stat-value" id="player2PrepHP">220</span>
                        </div>
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">âš”ï¸ Normal:</span>
                            <span class="prep-stat-value" id="player2PrepNormal">30</span>
                        </div>
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">ğŸ’¥ Special:</span>
                            <span class="prep-stat-value" id="player2PrepSpecial">55</span>
                        </div>
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">ğŸ”„ Normal Reload:</span>
                            <span class="prep-stat-value" id="player2PrepNormalReload">0.8s</span>
                        </div>
                        <div class="prep-stat-row">
                            <span class="prep-stat-label">âš¡ Special Reload:</span>
                            <span class="prep-stat-value" id="player2PrepSpecialReload">14.5s</span>
                        </div>
                    </div>
                </div>
            </div>

            <button class="button" onclick="showMapSelect()" style="position: absolute; bottom: 20px; left: 20px;">â† Back to Maps</button>
        </div>

        <!-- Battle Mode Selection Screen -->
        <div id="battleModeScreen" class="screen">
            <h2 class="title">âš”ï¸ Choose Battle Mode âš”ï¸</h2>
            <div class="map-selection">
                <div class="map-card" onclick="selectBattleMode('normal')">
                    <h3><span class="emoji">âš”ï¸</span> Normal Mode</h3>
                    <p>Classic battle mode</p>
                    <small>Pure skill-based combat</small>
                </div>
                <div class="map-card" onclick="selectBattleMode('special_drop')">
                    <h3><span class="emoji">ğŸ“¦</span> Special Drop Mode</h3>
                    <p>Items drop every 15 seconds</p>
                    <small>Swords, shields, nukes, and more!</small>
                </div>
                <div class="map-card" onclick="selectBattleMode('flag_capture')">
                    <h3><span class="emoji">ğŸ</span> Tis' my FLAG BOI</h3>
                    <p>Capture and hold the flag!</p>
                    <small>Hold for 15 seconds to win!</small>
                </div>
                <div id="bossBattleCard" class="map-card" onclick="selectBattleMode('boss_battle')" style="background: linear-gradient(45deg, #8B0000, #DC143C); border-color: #DC143C; display: none;">
                    <h3><span class="emoji">ğŸ‰</span> Boss Battle</h3>
                    <p>Team up vs Giant Boss!</p>
                    <small>2-Player Cooperative mode only!</small>
                </div>
                <!-- Single Player Tournament - Only show in single player mode -->
                <div id="singlePlayerTournamentCard" class="map-card" onclick="showTournamentSelect()" style="background: linear-gradient(45deg, #FFD700, #FFA500); border-color: #FFD700; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #FFD700, #FF6B35, #FFD700); animation: megaGlow 2s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold;">
                        <h3><span class="emoji">ğŸ†</span> Tournament Mode</h3>
                        <p>Win series for big rewards!</p>
                        <small>Entry fee required - Winner takes all!</small>
                    </div>
                </div>
                <!-- 2-Player Tournament - Only show in multiplayer mode -->
                <div id="multiPlayerTournamentCard" class="map-card" onclick="showTournamentSelect2Player()" style="background: linear-gradient(45deg, #9C27B0, #E91E63); border-color: #9C27B0; position: relative; overflow: hidden; display: none;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #9C27B0, #E91E63, #FF6B35, #E91E63, #9C27B0); animation: choosePulse 1.2s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); font-weight: bold;">
                        <h3><span class="emoji">ğŸ‘¥</span> 2-Player Tournament</h3>
                        <p>Compete head-to-head!</p>
                        <small>Both players on opposite bracket sides!</small>
                    </div>
                </div>
            </div>
            <button class="button" onclick="showMainMenu()">â† Back</button>
        </div>

        <!-- Tournament Selection Screen -->
        <div id="tournamentSelectScreen" class="screen" style="background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700); overflow-y: auto; padding: 20px;">
            <h2 class="title" style="color: #000; text-shadow: 2px 2px 4px rgba(255,255,255,0.5);">ğŸ† TOURNAMENT MODE ğŸ†</h2>
            <div class="player-selection-info" style="background: linear-gradient(45deg, #FF6B35, #F7931E); color: #FFD700; border: 2px solid #FFD700; font-size: 18px; margin-bottom: 30px;">
                ğŸ’° Pay entry fee â€¢ Win all rounds â€¢ Take the prize pool! ğŸ’°
            </div>

            <div class="map-selection" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto;">
                <!-- Rookie Tournament -->
                <div class="map-card tournament-card" style="background: linear-gradient(45deg, #4CAF50, #8BC34A); border-color: #4CAF50; position: relative; overflow: hidden; height: 240px; cursor: default;">
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold; text-align: center; padding: 10px;">
                        <h3><span class="emoji" style="font-size: 28px;">ğŸ¥‰</span><br>ROOKIE TOURNAMENT</h3>
                        <p style="margin: 8px 0; font-size: 15px;">Entry Fee: <strong>25 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 13px;">3 Rounds â€¢ Prize: <strong>75 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 12px; color: #2E7D32;">vs Common Characters</p>
                        <small style="color: #000; font-weight: bold;">Best of 3 series each round</small>
                        <button class="button" onclick="startTournament('rookie')" style="margin-top: 10px; padding: 8px 16px; font-size: 14px; background: #2E7D32;">ğŸ® Start Game</button>
                    </div>
                </div>

                <!-- Pro Tournament -->
                <div class="map-card tournament-card" style="background: linear-gradient(45deg, #2196F3, #03A9F4); border-color: #2196F3; position: relative; overflow: hidden; height: 240px; cursor: default;">
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold; text-align: center; padding: 10px;">
                        <h3><span class="emoji" style="font-size: 28px;">ğŸ¥ˆ</span><br>PRO TOURNAMENT</h3>
                        <p style="margin: 8px 0; font-size: 15px;">Entry Fee: <strong>50 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 13px;">4 Rounds â€¢ Prize: <strong>200 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 12px; color: #1565C0;">vs Rare Characters</p>
                        <small style="color: #000; font-weight: bold;">Best of 3 series each round</small>
                        <button class="button" onclick="startTournament('pro')" style="margin-top: 10px; padding: 8px 16px; font-size: 14px; background: #1565C0;">ğŸ® Start Game</button>
                    </div>
                </div>

                <!-- Champion Tournament -->
                <div class="map-card tournament-card" style="background: linear-gradient(45deg, #FF9800, #FFD700); border-color: #FF9800; position: relative; overflow: hidden; height: 240px; cursor: default;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #FF9800, #FFD700, #FF6B35, #FFD700, #FF9800); animation: legendaryPulse 1.5s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold; text-align: center; padding: 10px;">
                        <h3><span class="emoji" style="font-size: 28px;">ğŸ¥‡</span><br>CHAMPION TOURNAMENT</h3>
                        <p style="margin: 8px 0; font-size: 15px;">Entry Fee: <strong>100 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 13px;">5 Rounds â€¢ Prize: <strong>500 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 12px; color: #E65100;">vs Epic Characters</p>
                        <small style="color: #000; font-weight: bold;">Best of 3 series each round</small>
                        <button class="button" onclick="startTournament('champion')" style="margin-top: 10px; padding: 8px 16px; font-size: 14px; background: #E65100;">ğŸ® Start Game</button>
                    </div>
                </div>

                <!-- Legendary Tournament -->
                <div class="map-card tournament-card" style="background: linear-gradient(45deg, #9C27B0, #E91E63); border-color: #9C27B0; position: relative; overflow: hidden; height: 240px; cursor: default;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #9C27B0, #E91E63, #FF6B35, #E91E63, #9C27B0); animation: choosePulse 1.2s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); font-weight: bold; text-align: center; padding: 10px;">
                        <h3><span class="emoji" style="font-size: 28px;">ğŸ‘‘</span><br>LEGENDARY TOURNAMENT</h3>
                        <p style="margin: 8px 0; font-size: 15px;">Entry Fee: <strong>200 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 13px;">6 Rounds â€¢ Prize: <strong>1000 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 12px; color: #FFD700;">vs Legendary Characters</p>
                        <small style="color: #FFD700; font-weight: bold;">Best of 3 series each round</small>
                        <button class="button" onclick="startTournament('legendary')" style="margin-top: 10px; padding: 8px 16px; font-size: 14px; background: #6A1B9A;">ğŸ® Start Game</button>
                    </div>
                </div>
            </div>

            <div id="tournamentStatus" style="margin-top: 30px; text-align: center; font-size: 18px; font-weight: bold; color: #000; display: none;">
                <!-- Tournament progress will be shown here -->
            </div>

            <div style="position: sticky; bottom: 10px; z-index: 100; display: flex; gap: 10px; justify-content: center;">
                <button class="button" onclick="showBattleModeSelect()">â† Back</button>
                <button class="button" onclick="forfeitTournament()" style="background: #FF4444; border-color: #FF4444;" id="forfeitButton">âŒ Forfeit Tournament</button>
            </div>
        </div>

        <!-- 2-Player Tournament Selection Screen -->
        <div id="tournament2PlayerScreen" class="screen" style="background: linear-gradient(45deg, #9C27B0, #E91E63, #9C27B0); overflow-y: auto; padding: 20px;">
            <h2 class="title" style="color: #FFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">ğŸ‘¥ 2-PLAYER TOURNAMENT ğŸ‘¥</h2>
            <div class="player-selection-info" style="background: linear-gradient(45deg, #FF6B35, #F7931E); color: #FFD700; border: 2px solid #FFD700; font-size: 18px; margin-bottom: 30px;">
                ğŸ† Both players start on opposite sides of the bracket! Meet in the finals if you both advance! ğŸ†
            </div>

            <div class="map-selection" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto;">
                <!-- Rookie 2P Tournament -->
                <div class="map-card tournament-card" style="background: linear-gradient(45deg, #4CAF50, #8BC34A); border-color: #4CAF50; position: relative; overflow: hidden; height: 260px; cursor: default;">
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold; text-align: center; padding: 10px;">
                        <h3><span class="emoji" style="font-size: 28px;">ğŸ¥‰</span><br>ROOKIE 2P TOURNAMENT</h3>
                        <p style="margin: 8px 0; font-size: 15px;">Entry Fee: <strong>25 coins each</strong></p>
                        <p style="margin: 5px 0; font-size: 13px;">3 Rounds â€¢ Prize: <strong>100 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 12px; color: #2E7D32;">vs Common Characters</p>
                        <small style="color: #000; font-weight: bold;">Take turns playing series</small>
                        <small style="display: block; color: #000; font-weight: bold;">Meet in finals if both advance!</small>
                        <button class="button" onclick="start2PlayerTournament('rookie')" style="margin-top: 10px; padding: 8px 16px; font-size: 14px; background: #2E7D32;">ğŸ® Start Game</button>
                    </div>
                </div>

                <!-- Pro 2P Tournament -->
                <div class="map-card tournament-card" style="background: linear-gradient(45deg, #2196F3, #03A9F4); border-color: #2196F3; position: relative; overflow: hidden; height: 260px; cursor: default;">
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold; text-align: center; padding: 10px;">
                        <h3><span class="emoji" style="font-size: 28px;">ğŸ¥ˆ</span><br>PRO 2P TOURNAMENT</h3>
                        <p style="margin: 8px 0; font-size: 15px;">Entry Fee: <strong>50 coins each</strong></p>
                        <p style="margin: 5px 0; font-size: 13px;">4 Rounds â€¢ Prize: <strong>300 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 12px; color: #1565C0;">vs Rare Characters</p>
                        <small style="color: #000; font-weight: bold;">Take turns playing series</small>
                        <small style="display: block; color: #000; font-weight: bold;">Meet in finals if both advance!</small>
                        <button class="button" onclick="start2PlayerTournament('pro')" style="margin-top: 10px; padding: 8px 16px; font-size: 14px; background: #1565C0;">ğŸ® Start Game</button>
                    </div>
                </div>

                <!-- Champion 2P Tournament -->
                <div class="map-card tournament-card" style="background: linear-gradient(45deg, #FF9800, #FFD700); border-color: #FF9800; position: relative; overflow: hidden; height: 260px; cursor: default;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #FF9800, #FFD700, #FF6B35, #FFD700, #FF9800); animation: legendaryPulse 1.5s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #000000; text-shadow: 2px 2px 4px rgba(255,255,255,0.8); font-weight: bold; text-align: center; padding: 10px;">
                        <h3><span class="emoji" style="font-size: 28px;">ğŸ¥‡</span><br>CHAMPION 2P TOURNAMENT</h3>
                        <p style="margin: 8px 0; font-size: 15px;">Entry Fee: <strong>100 coins each</strong></p>
                        <p style="margin: 5px 0; font-size: 13px;">5 Rounds â€¢ Prize: <strong>750 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 12px; color: #E65100;">vs Epic Characters</p>
                        <small style="color: #000; font-weight: bold;">Take turns playing series</small>
                        <small style="display: block; color: #000; font-weight: bold;">Meet in finals if both advance!</small>
                        <button class="button" onclick="start2PlayerTournament('champion')" style="margin-top: 10px; padding: 8px 16px; font-size: 14px; background: #E65100;">ğŸ® Start Game</button>
                    </div>
                </div>

                <!-- Legendary 2P Tournament -->
                <div class="map-card tournament-card" style="background: linear-gradient(45deg, #9C27B0, #E91E63); border-color: #9C27B0; position: relative; overflow: hidden; height: 260px; cursor: default;">
                    <div style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, #9C27B0, #E91E63, #FF6B35, #E91E63, #9C27B0); animation: choosePulse 1.2s ease-in-out infinite; z-index: 0;"></div>
                    <div style="position: relative; z-index: 10; color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); font-weight: bold; text-align: center; padding: 10px;">
                        <h3><span class="emoji" style="font-size: 28px;">ğŸ‘‘</span><br>LEGENDARY 2P TOURNAMENT</h3>
                        <p style="margin: 8px 0; font-size: 15px;">Entry Fee: <strong>200 coins each</strong></p>
                        <p style="margin: 5px 0; font-size: 13px;">6 Rounds â€¢ Prize: <strong>1500 coins</strong></p>
                        <p style="margin: 5px 0; font-size: 12px; color: #FFD700;">vs Legendary Characters</p>
                        <small style="color: #FFD700; font-weight: bold;">Take turns playing series</small>
                        <small style="display: block; color: #FFD700; font-weight: bold;">Meet in finals if both advance!</small>
                        <button class="button" onclick="start2PlayerTournament('legendary')" style="margin-top: 10px; padding: 8px 16px; font-size: 14px; background: #6A1B9A;">ğŸ® Start Game</button>
                    </div>
                </div>
            </div>

            <div id="tournament2PlayerStatus" style="margin-top: 30px; text-align: center; font-size: 18px; font-weight: bold; color: #FFF; display: none;">
                <!-- 2-Player tournament progress will be shown here -->
            </div>

            <div style="position: sticky; bottom: 10px; z-index: 100; display: flex; gap: 10px; justify-content: center;">
                <button class="button" onclick="showBattleModeSelect()">â† Back</button>
                <button class="button" onclick="forfeit2PlayerTournament()" style="background: #FF4444; border-color: #FF4444;" id="forfeit2PlayerButton">âŒ Forfeit Tournament</button>
            </div>
        </div>

        <!-- Choose Character Screen for 1000 Coin Chest -->
        <div id="chooseCharacterScreen" class="screen" style="overflow-y: auto; padding: 20px;">
            <h2 class="title" style="color: #FFD700;">ğŸ¯ CHOOSE YOUR CHARACTER ğŸ¯</h2>
            <div class="player-selection-info" style="background: linear-gradient(45deg, #9C27B0, #E91E63); color: #FFD700; border: 2px solid #FFD700;">
                ğŸ’° Pick ANY character you want! ğŸ’°
            </div>
            <div id="chooseCharacterGrid" class="character-grid" style="max-height: 65vh;"></div>
            <button class="button" onclick="cancelChooseCharacter()" style="position: sticky; bottom: 10px; z-index: 100;">â† Cancel</button>
        </div>

        <!-- Challenges Screen -->
        <div id="challengesScreen" class="screen" style="background: linear-gradient(45deg, #9C27B0, #E91E63, #FF6B35); overflow-y: auto; padding: 20px;">
            <h2 class="title" style="color: #FFFFFF; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">ğŸ¯ DAILY CHALLENGES ğŸ¯</h2>
            <div id="challengesPlayerInfo" class="player-selection-info" style="background: linear-gradient(45deg, #FF6B35, #F7931E); color: #FFD700; border: 2px solid #FFD700; font-size: 18px;"></div>
            <div id="challengesContainer" style="max-height: 65vh; overflow-y: auto; background: rgba(0,0,0,0.1); border-radius: 15px; padding: 20px;"></div>
            <button class="button" onclick="returnToMainMenuWithLoading('challenges')" style="position: sticky; bottom: 10px; z-index: 100;">â† Back</button>
        </div>

        <!-- Badges Screen -->
        <div id="badgesScreen" class="screen" style="background: linear-gradient(45deg, #FFD700, #FF9800, #FFD700); overflow-y: auto; padding: 20px;">
            <h2 class="title" style="color: #000; text-shadow: 2px 2px 4px rgba(255,255,255,0.5);">ğŸ… BADGES & POWERUPS ğŸ…</h2>
            <div id="badgesPlayerInfo" class="player-selection-info" style="background: linear-gradient(45deg, #FF6B35, #F7931E); color: #FFD700; border: 2px solid #FFD700; font-size: 18px;"></div>
            <div id="badgesContainer" style="max-height: 65vh; overflow-y: auto; background: rgba(0,0,0,0.1); border-radius: 15px; padding: 20px;"></div>
            <button class="button" onclick="returnToMainMenuWithLoading('badges')" style="position: sticky; bottom: 10px; z-index: 100;">â† Back</button>
        </div>

        <!-- Trophy Road Screen -->
        <div id="trophyRoadScreen" class="screen" style="background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700); overflow-y: auto; padding: 20px; position: relative;">
            <div style="position: fixed; top: 50%; left: 0; right: 0; transform: translateY(-50%); display: flex; flex-direction: row; justify-content: space-between; align-items: center; padding: 0 40px; flex-wrap: nowrap; pointer-events: none; z-index: 1;">
                <div id="trophyRoadCount" style="font-size: 48px; font-weight: bold; color: #FFD700; text-shadow: 3px 3px 6px rgba(0,0,0,0.8), 0 0 20px rgba(255,215,0,0.6); flex-shrink: 0; background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2)); padding: 15px 25px; border-radius: 15px; border: 3px solid #FFD700;">
                    ğŸ† <span id="trophyRoadCountNumber">0</span>
                </div>
                <h2 class="title" style="font-size: 44px; margin: 0; margin-right: 40px; color: #FFD700; text-shadow: 4px 4px 8px rgba(0,0,0,0.9), 0 0 30px rgba(255,215,0,0.7); flex-shrink: 0; font-weight: 900; letter-spacing: 3px; background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2)); padding: 13px 22px; border-radius: 20px; border: 4px solid #FFD700; transform: translateX(80px);">Trophy Road</h2>
            </div>
            <div id="trophyRoadPlayerInfo" class="player-selection-info" style="background: linear-gradient(45deg, #FF6B35, #F7931E); color: #FFD700; border: 2px solid #FFD700; font-size: 18px; position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2; width: auto; max-width: 80%;"></div>
            <div id="trophyRoadContainer" style="max-height: 65vh; overflow-y: auto; background: rgba(0,0,0,0.1); border-radius: 15px; padding: 20px; position: relative; z-index: 2;"></div>
            <button class="button" onclick="returnToMainMenuWithLoading('trophyroad')" style="position: sticky; bottom: 10px; z-index: 100;">â† Back</button>
        </div>

        <!-- Battle Screen -->
        <div id="battleScreen" class="screen battle-screen" style="padding: 0; margin: 0; width: 100vw; height: 100vh; position: fixed; top: 0; left: 0;">
            <canvas id="gameCanvas"></canvas>
            <div class="game-ui">
                <div><strong id="player1Name">Player 1</strong></div>
                <div class="health-bar">
                    <div id="player1Health" class="health-fill" style="width: 100%"></div>
                </div>
                <div id="player1Addons" style="font-size: 11px; color: #FFD700; margin-top: 5px; line-height: 1.4;"></div>
                <div style="margin-top: 15px;"><strong id="player2Name">CPU</strong></div>
                <div class="health-bar">
                    <div id="player2Health" class="health-fill" style="width: 100%"></div>
                </div>
                <div id="player2Addons" style="font-size: 11px; color: #FFD700; margin-top: 5px; line-height: 1.4;"></div>
            </div>

            <button class="button" style="position: fixed; top: 20px; right: 20px; z-index: 10; background: rgba(255,0,0,0.8); border: 2px solid #fff; backdrop-filter: blur(10px);" onclick="endBattle()">â† Menu</button>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <!-- Chest Opening Animation -->
    <div id="chestOpening" class="chest-opening">
        <div class="chest-animation">
            <div class="chest-lid"></div>
            <div id="characterReveal" class="character-reveal emoji"></div>
            <div id="rarityGlow" class="rarity-glow"></div>
            <div id="rarityText" class="rarity-text"></div>
        </div>
        <div id="particles" class="particles"></div>
    </div>

    <!-- Loading Screen with Challenge Check -->
    <div id="loadingScreen" class="loading-screen" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner">âš”ï¸</div>
            <h2 id="loadingTitle" style="color: #FFD700; margin: 20px 0; font-size: 32px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">Loading...</h2>
            <div id="loadingMessage" style="color: #FFF; font-size: 18px; margin-bottom: 20px;">Checking for completed challenges...</div>
            <div id="challengeCompletionContainer" style="max-width: 600px; margin: 0 auto;"></div>
        </div>
    </div>

</body>
</html>